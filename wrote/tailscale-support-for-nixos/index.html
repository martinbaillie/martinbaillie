<!doctype html><html><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><title>Martin Baillie | Tailscale Support for NixOS</title><meta name=robots content="index, follow"><meta name=googlebot content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1"><meta name=bingbot content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1"><link rel=canonical href=https://martin.baillie.id/wrote/tailscale-support-for-nixos/><meta property="og:title" content="Martin Baillie | Tailscale Support for NixOS"><meta name=description content="I have been continuing to run with Tailscale instead of hand-cranked WireGuard on various devices, including my daily driver ThinkPad which runs my other favourite OS—NixOS!
However, until now the configuration was not particularly idiomatic due to there being no upstream Tailscale Nix expressions in nixpkgs.
As it transpired, Dan Anderson of Tailscale is also a NixOS user and with his support I was able to shepherd in a quick PR to introduce a Tailscale module."><meta property="og:image" content="https://martin.baillie.id//img/me.jpg"><meta itemprop=name content="Martin Baillie | Tailscale Support for NixOS"><meta name=application-name content="Martin Baillie"><meta property="og:site_name" content="Martin Baillie"><meta property="og:title" content="Tailscale Support for NixOS"><meta property="og:description" content="I have been continuing to run with Tailscale instead of hand-cranked WireGuard on various devices, including my daily driver ThinkPad which runs my other favourite OS—NixOS!
However, until now the configuration was not particularly idiomatic due to there being no upstream Tailscale Nix expressions in nixpkgs.
As it transpired, Dan Anderson of Tailscale is also a NixOS user and with his support I was able to shepherd in a quick PR to introduce a Tailscale module."><meta property="og:type" content="article"><meta property="og:url" content="https://martin.baillie.id/wrote/tailscale-support-for-nixos/"><meta property="article:published_time" content="2020-03-20T00:00:00+11:00"><meta property="article:modified_time" content="2020-03-20T00:00:00+11:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Tailscale Support for NixOS"><meta name=twitter:description content="I have been continuing to run with Tailscale instead of hand-cranked WireGuard on various devices, including my daily driver ThinkPad which runs my other favourite OS—NixOS!
However, until now the configuration was not particularly idiomatic due to there being no upstream Tailscale Nix expressions in nixpkgs.
As it transpired, Dan Anderson of Tailscale is also a NixOS user and with his support I was able to shepherd in a quick PR to introduce a Tailscale module."><meta name=twitter:site content="@martinbaillie"><meta name=twitter:creator content="@martinbaillie"><meta name=twitter:image content="https://martin.baillie.id//img/me.jpg"><link rel=apple-touch-icon sizes=57x57 href=/img/favicon/apple-icon-57x57.png><link rel=apple-touch-icon sizes=60x60 href=/img/favicon/apple-icon-60x60.png><link rel=apple-touch-icon sizes=72x72 href=/img/favicon/apple-icon-72x72.png><link rel=apple-touch-icon sizes=76x76 href=/img/favicon/apple-icon-76x76.png><link rel=apple-touch-icon sizes=114x114 href=/img/favicon/apple-icon-114x114.png><link rel=apple-touch-icon sizes=120x120 href=/img/favicon/apple-icon-120x120.png><link rel=apple-touch-icon sizes=144x144 href=/img/favicon/apple-icon-144x144.png><link rel=apple-touch-icon sizes=152x152 href=/img/favicon/apple-icon-152x152.png><link rel=apple-touch-icon sizes=180x180 href=/img/favicon/apple-icon-180x180.png><link rel=icon type=image/png sizes=192x192 href=/img/favicon/android-icon-192x192.png><link rel=icon type=image/png sizes=32x32 href=/img/favicon/favicon-32x32.png><link rel=icon type=image/png sizes=96x96 href=/img/favicon/favicon-96x96.png><link rel=icon type=image/png sizes=16x16 href=/img/favicon/favicon-16x16.png><link rel=manifest href=/img/favicon/manifest.json><meta name=msapplication-TileImage content="/img/favicon/ms-icon-144x144.png"><meta name=msapplication-TileColor content="#ffffff"><meta name=theme-color content="#ffffff"><script src=https://martin.baillie.id/main.7e4f48e8542b3b653a252ce4bc2041e90ebc755bd0811624bf4209201afc184d39c2507eab1b75ef7883bc5f968e13bd392dc6df7840375b224be41eb25a70cd.js integrity="sha512-fk9I6FQrO2U6JSzkvCBB6Q68dVvQgRYkv0IJIBr8GE05wlB+qxt173iDvF+WjhO9OS3G33hAN1siS+QeslpwzQ==" crossorigin=anonymous onload="WebFont.load({custom:{families:['Roboto Mono']}});feather.replace();" defer></script><link rel="stylesheet preload prefetch" as=style type=text/css media=screen href=https://martin.baillie.id/main.1a92a966a2a8f7588c617b795cff11e8b0e38fca99a44048a51198066a1894610096b89c16e109d9f38f37ebe4e9db238df38d7f190459089474dbe9c7d02cb3.css integrity="sha512-GpKpZqKo91iMYXt5XP8R6LDjj8qZpEBIpRGYBmoYlGEAlricFuEJ2fOPN+vk6dsjjfONfxkEWQiUdNvpx9Assw==" crossorigin=anonymous></head><body><div class=content><header><div class=main><a href=https://martin.baillie.id/>Martin Baillie</a></div><nav><a class=soc id=tags href=/tags title=Tags><i data-feather=tag></i></a><a class=soc id=feed href=/index.xml title="RSS Feed"><i data-feather=rss></i></a><a class=soc id=mode href=javascript:toggleMode(); title="Switch Theme"><i data-feather=moon></i></a></nav></header><main><article><div class=title><h1>Tailscale Support for NixOS</h1></div><div class=meta><div class=posted><i data-feather=edit-3></i>20200320</div><div class=reading><i data-feather=clock></i>~04 mins</div></div><div class=tldr><strong>tl;dr:</strong>
Learn how to configure Tailscale on NixOS.</div><section class=body><div class=single><p>I have been <a href=/wrote/tailscale-support-for-openbsd>continuing</a> to run with Tailscale instead of hand-cranked WireGuard
on various devices, including my daily driver ThinkPad which runs my <em>other</em>
favourite OS—<a href=https://nixos.org/>NixOS</a>!</p><p>However, until now the configuration was not particularly idiomatic due to there
being no upstream Tailscale Nix expressions in <a href=https://github.com/NixOS/nixpkgs>nixpkgs</a>.</p><p>As it transpired, Dan Anderson of Tailscale is also a NixOS user and with his
support I was able to shepherd in a <a href=https://github.com/NixOS/nixpkgs/pull/82537>quick PR</a> to introduce a Tailscale <a href="https://search.nixos.org/options?query=tailscale">module</a>. I
actually think NixOS ended up being their first Linux flavoured package!</p><p>Like the previous OpenBSD post, the rest of this post will walk you through how
to set up Tailscale on NixOS.</p><h2 id=installing-tailscale-on-nixos>Installing Tailscale on NixOS</h2><p>It&rsquo;s simple!</p><div class=highlight><pre class=chroma><code class=language-nix data-lang=nix><span class=n>services</span><span class=o>.</span><span class=n>tailscale</span><span class=o>.</span><span class=n>enable</span> <span class=err>=</span> <span class=no>true</span><span class=p>;</span>

<span class=c1># Optional (default: 41641):</span>
<span class=n>services</span><span class=o>.</span><span class=n>tailscale</span><span class=o>.</span><span class=n>port</span> <span class=err>=</span> <span class=mi>12345</span><span class=p>;</span>
</code></pre></div><p>You can choose to make it easier for Tailscale by opening up the UDP port.</p><div class=highlight><pre class=chroma><code class=language-nix data-lang=nix><span class=n>networking</span><span class=o>.</span><span class=n>firewall</span><span class=o>.</span><span class=n>allowedUDPPorts</span> <span class=err>=</span> <span class=p>[</span> <span class=err>$</span><span class=p>{</span><span class=n>services</span><span class=o>.</span><span class=n>tailscale</span><span class=o>.</span><span class=n>port</span><span class=p>}</span> <span class=p>];</span>
</code></pre></div><p>Depending on your setup, you may need to make the <code>tailscale</code> CLI available to
all users.</p><div class=highlight><pre class=chroma><code class=language-nix data-lang=nix><span class=n>environment</span><span class=o>.</span><span class=n>systemPackages</span> <span class=err>=</span> <span class=k>with</span> <span class=n>pkgs</span><span class=p>;</span> <span class=p>[</span> <span class=n>tailscale</span> <span class=p>];</span>
</code></pre></div><p>That&rsquo;s the configuration out of the way. If you perform a <code>rebuild-switch</code>, you
should find a Tailscale daemon running.</p><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell><span class=p>;</span> systemctl status tailscale
</code></pre></div><p>Finally, perform an initial authentication for this machine and you&rsquo;re done.</p><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell><span class=p>;</span> tailscale up
</code></pre></div><p>You should be able to see a successfully plumbed device, and Tailscale logs
scrolling.</p><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell><span class=p>;</span> ip link show tailscale0
<span class=p>;</span> journalctl -fu tailscale
</code></pre></div></div></section><div class=post-tags><nav class="nav tags"><ul class=tags><li><a href=/tags/nix>nix</a></li><li><a href=/tags/tailscale>tailscale</a></li><li><a href=/tags/wireguard>wireguard</a></li><li><a href=/tags/security>security</a></li></ul></nav></div></article></main><footer><hr><a class=soc href=https://github.com/martinbaillie title=GitHub><i data-feather=github></i></a><a class=soc href=https://linkedin.com/in/martinbaillie title=LinkedIn><i data-feather=linkedin></i></a><a class=soc href=https://twitter.com/martinbaillie title=Twitter><i data-feather=twitter></i></a><a class=soc href=mailto:martin@baillie.id title=Email><i data-feather=mail></i></a><a class=soc href=https://github.com/martinbaillie.gpg title="GPG Public Key">C2F0 79DE D64B 7361 006A A099 2A56 EA64 591E 15E4</a>
<a class=menu href=/id>$id</a>
<span class="active menu">fieldnotes</span></footer><script data-goatcounter=https://martinbaillie.goatcounter.com/count async src=//gc.zgo.at/count.js></script></div></body></html>